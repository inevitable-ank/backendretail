// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Users table - stores user profile information
model User {
  id        String   @id @db.Uuid
  email     String   @unique @db.Text
  name      String?  @db.Text
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@map("users")
}

// Transaction table - stores retail sales transaction data
model Transaction {
  id                String   @id @default(uuid()) @db.Uuid
  transactionId     String   @unique @db.Text
  date              DateTime @db.Date
  customerId        String   @db.Text
  customerName      String   @db.Text
  phoneNumber       String   @db.Text
  gender            String   @db.Text
  age               Int
  customerRegion    String   @db.Text
  customerType      String?  @db.Text
  productId         String   @db.Text
  productName       String?  @db.Text
  brand             String?  @db.Text
  productCategory   String   @db.Text
  tags              String?  @db.Text // Stored as comma-separated string
  quantity          Int
  pricePerUnit      Decimal  @db.Decimal(12, 2)
  discountPercentage Decimal @db.Decimal(5, 2) @map("discount_percentage")
  totalAmount       Decimal  @db.Decimal(12, 2)
  finalAmount       Decimal  @db.Decimal(12, 2)
  paymentMethod     String   @db.Text
  orderStatus       String?  @db.Text
  deliveryType      String?  @db.Text
  storeId           String?  @db.Text
  storeLocation     String?  @db.Text
  salespersonId     String?  @db.Text
  employeeName      String   @db.Text
  createdAt         DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Indexes for performance optimization
  @@index([customerName])
  @@index([phoneNumber])
  @@index([customerRegion])
  @@index([gender])
  @@index([age])
  @@index([productCategory])
  @@index([paymentMethod])
  @@index([date])
  @@index([transactionId])
  @@map("transactions")
}

// CSV Upload History - tracks file uploads
model CsvUpload {
  id          String   @id @default(uuid()) @db.Uuid
  fileName    String   @db.Text
  fileSize    BigInt   @map("file_size")
  totalRecords Int     @map("total_records")
  importedRecords Int  @map("imported_records")
  failedRecords Int     @default(0) @map("failed_records")
  status      String   @db.Text // "completed", "failed", "processing"
  errorMessage String? @db.Text @map("error_message")
  uploadedBy  String?  @db.Text @map("uploaded_by") // User email or ID
  uploadedAt  DateTime @default(now()) @map("uploaded_at") @db.Timestamptz(6)

  @@index([uploadedAt])
  @@index([status])
  @@map("csv_uploads")
}
